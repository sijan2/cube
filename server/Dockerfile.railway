FROM node:20-alpine

WORKDIR /app

# Copy everything at once
COPY . .

# Debug: List files to verify they're copied
RUN ls -la && echo "---" && ls -la *.json *.yaml 2>/dev/null || true

# Install dependencies using npm
RUN npm install

# Build the application
RUN npm run build

# Expose port (Railway will assign PORT env var)
EXPOSE ${PORT:-3003}

# Start the server with Railway's PORT
CMD ["sh", "-c", "PORT=${PORT:-3003} node dist/index.js"]